@model IEnumerable<CÃ¼zdan_UygulamasÄ±.BusinessLogic.DTOs.TransactionDto>
@{
    ViewData["Title"] = "Gelir/Gider Ä°ÅŸlemleri";
    var summary = ViewBag.Summary as CÃ¼zdan_UygulamasÄ±.BusinessLogic.DTOs.TransactionSummaryDto;
    var filter = ViewBag.Filter as CÃ¼zdan_UygulamasÄ±.BusinessLogic.DTOs.TransactionFilterDto;
    var filterAccounts = ViewBag.FilterAccounts as Microsoft.AspNetCore.Mvc.Rendering.SelectList;
    var filterCategories = ViewBag.FilterCategories as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>;
    var filterTransactionTypes = ViewBag.FilterTransactionTypes as Microsoft.AspNetCore.Mvc.Rendering.SelectList;
    var filterRecurringOptions = ViewBag.FilterRecurringOptions as Microsoft.AspNetCore.Mvc.Rendering.SelectList;
}


<div class="container-fluid px-4">
    <!-- Header -->
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="mb-0">ðŸ“Š Gelir/Gider Ä°ÅŸlemleri</h2>
                <p class="text-muted mb-0">TÃ¼m finansal iÅŸlemlerinizi gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin</p>
            </div>
            <div class="col-auto">
                <a asp-action="Create" class="btn-primary-action">
                    <i class="fas fa-plus me-2"></i>Yeni Ä°ÅŸlem
                </a>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    @if (summary != null)
    {
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-success">
                            <i class="fas fa-arrow-up fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Toplam Gelir</h6>
                        <h4 class="text-success">â‚º@summary.TotalIncome.ToString("N2")</h4>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-danger">
                            <i class="fas fa-arrow-down fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Toplam Gider</h6>
                        <h4 class="text-danger">â‚º@summary.TotalExpense.ToString("N2")</h4>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-info">
                            <i class="fas fa-calculator fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Net Tutar</h6>
                        <h4 class="@(summary.NetAmount >= 0 ? "text-success" : "text-danger")">
                            â‚º@summary.NetAmount.ToString("N2")
                        </h4>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-primary">
                            <i class="fas fa-list fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Toplam Ä°ÅŸlem</h6>
                        <h4 class="text-primary">@summary.TransactionCount</h4>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Transactions List -->
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Ä°ÅŸlemler</h5>
          <span class="transaction-count">
            @Model.Count() transaction@(Model.Count() != 1 ? "s" : "") found
          </span>
        </div>

        @if (Model.Any())
        {
          <div class="item-list">
            @foreach (var transaction in Model)
            {
              var isIncome = transaction.Type == CÃ¼zdan_UygulamasÄ±.Models.TransactionType.Income;
              <div class="item-card">
                <div class="item-inner">
                  <!-- Avatar -->
                  <div class="item-avatar @(isIncome ? "item-avatar--income" : "item-avatar--expense")" aria-hidden="true">
                    <i class="fas @(isIncome ? "fa-arrow-up" : "fa-arrow-down")"></i>
                  </div>

                  <!-- Meta -->
                  <div class="item-content">
                    <p class="title">@transaction.Description</p>
                    <p class="meta">
                      @transaction.Account?.Name
                      @if (transaction.Category != null)
                      {
                        <span class="item-chip"><i class="fas fa-tag"></i> @transaction.Category.Name</span>
                      }
                      @if (transaction.IsRecurring)
                      {
                        <span class="item-chip"><i class="fas fa-sync-alt"></i> Otomatik</span>
                      }
                      â€¢ @transaction.TransactionDate.ToString("dd MMMM yyyy, HH:mm")
                    </p>
                  </div>

                  <!-- Amount & actions -->
                  <div class="item-amount">
                    <p class="value @(isIncome ? "positive" : "negative")">
                      @(isIncome ? "+" : "-")â‚º@transaction.Amount.ToString("N2")
                    </p>
                    <div class="item-actions">
                      <a asp-action="Details"
                         asp-route-id="@transaction.Id"
                         class="btn-view-action"
                         title="Detay">
                        <i class="fas fa-eye"></i><span>Detay</span>
                      </a>
                      <a asp-action="Edit"
                         asp-route-id="@transaction.Id"
                         class="btn-edit-action"
                         title="DÃ¼zenle">
                        <i class="fas fa-edit"></i><span>DÃ¼zenle</span>
                      </a>
                      <button type="button"
                              class="btn-danger-action"
                              onclick="deleteTransaction(@transaction.Id)"
                              title="Sil">
                        <i class="fas fa-trash"></i><span>Sil</span>
                      </button>
                    </div>
                  </div>
                </div> <!-- /.txn-inner -->
              </div> <!-- /.txn-item -->
            }
          </div>

          <!-- Pagination (opsiyonel) -->
          <div class="d-flex justify-content-center mt-4">
            <nav aria-label="Transaction pagination">
              @* Sayfalama eklenecekse buraya *@
            </nav>
          </div>
        }
        else
        {
          <div class="card border-0 shadow-sm">
            <div class="card-body empty-state">
              <i class="fas fa-receipt fa-4x mb-3"></i>
              <h4>HenÃ¼z iÅŸlem bulunmuyor</h4>
              <p>Ä°lk gelir veya gider iÅŸleminizi oluÅŸturarak baÅŸlayÄ±n.</p>
              <a asp-action="Create" class="btn-primary-action">
                <i class="fas fa-plus me-2"></i>Ä°lk Ä°ÅŸlemimi Ekle
              </a>
            </div>
          </div>
        }
      </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

        // Success/Error messages
        @if (TempData["Success"] != null)
        {
            <text>
            Swal.fire({
                icon: 'success',
                title: 'BaÅŸarÄ±lÄ±!',
                text: '@Html.Raw(TempData["Success"])',
                timer: 3000,
                showConfirmButton: false
            });
            </text>
        }

        @if (TempData["Error"] != null)
        {
            <text>
            Swal.fire({
                icon: 'error',
                title: 'Hata!',
                text: '@Html.Raw(TempData["Error"])'
            });
            </text>
        }
    </script>
}
