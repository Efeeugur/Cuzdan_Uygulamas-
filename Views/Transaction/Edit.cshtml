@model Cüzdan_Uygulaması.BusinessLogic.DTOs.UpdateTransactionDto
@{
    ViewData["Title"] = "İşlem Düzenle";
    var accounts = ViewBag.Accounts as Microsoft.AspNetCore.Mvc.Rendering.SelectList;
    var categories = ViewBag.Categories as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>;
}

@section Styles {
    <link rel="stylesheet" href="~/css/shared.css" />
    <link rel="stylesheet" href="~/css/transaction.css" />
}



<div class="container-fluid px-4">
    <div class="form-container">
        <div class="form-header">
            <h2 class="mb-2">
                <i class="bi bi-pencil form-icon"></i>
                İşlem Düzenle
            </h2>
            <p class="text-muted mb-0">İşlem bilgilerini güncelleyin</p>
        </div>

        <div class="form-body">
            <form asp-action="Edit" method="post" novalidate>
                <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                
                <input asp-for="Id" type="hidden" />

                <!-- Transaction Type Selector -->
                <div class="transaction-type-selector">
                    <div class="type-option income" onclick="selectTransactionType(0)">
                        <div class="type-icon">
                            <i class="bi bi-arrow-up"></i>
                        </div>
                        <h5 class="mb-1">Gelir</h5>
                        <p class="small text-muted mb-0">Maaş, prim, satış vb.</p>
                    </div>
                    <div class="type-option expense" onclick="selectTransactionType(1)">
                        <div class="type-icon">
                            <i class="bi bi-arrow-down"></i>
                        </div>
                        <h5 class="mb-1">Gider</h5>
                        <p class="small text-muted mb-0">Alışveriş, fatura vb.</p>
                    </div>
                </div>
                <input asp-for="Type" type="hidden" id="Type" />

                <div class="row">
                    <div class="col-md-8 mb-4">
                        <label asp-for="Description" class="form-label">
                            <i class="bi bi-pencil form-icon"></i>Açıklama *
                        </label>
                        <input asp-for="Description" class="form-control" 
                               placeholder="örn: Market alışverişi, Maaş ödemesi" />
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                    <div class="col-md-4 mb-4">
                        <label asp-for="Amount" class="form-label">
                            <i class="bi bi-currency-dollar form-icon"></i>Tutar *
                        </label>
                        <div class="input-group">
                            <span class="input-group-text">₺</span>
                            <input asp-for="Amount" class="form-control" 
                                   placeholder="0,00" step="0.01" type="number" />
                        </div>
                        <span asp-validation-for="Amount" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-4">
                        <label asp-for="AccountId" class="form-label">
                            <i class="bi bi-building form-icon"></i>Hesap *
                        </label>
                        <select asp-for="AccountId" asp-items="accounts" class="form-select">
                            <option value="">Hesap seçin...</option>
                        </select>
                        <span asp-validation-for="AccountId" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 mb-4">
                        <label asp-for="CategoryId" class="form-label">
                            <i class="bi bi-tags form-icon"></i>Kategori
                        </label>
                        <select asp-for="CategoryId" asp-items="categories" class="form-select" id="CategoryId">
                            <option value="">Kategori seçin (isteğe bağlı)</option>
                        </select>
                        <span asp-validation-for="CategoryId" class="text-danger"></span>
                    </div>
                </div>

                <div class="mb-4">
                    <label asp-for="TransactionDate" class="form-label">
                        <i class="bi bi-calendar form-icon"></i>İşlem Tarihi *
                    </label>
                    <input asp-for="TransactionDate" class="form-control" type="datetime-local" />
                    <span asp-validation-for="TransactionDate" class="text-danger"></span>
                    <div class="form-help">İşlemin gerçekleştiği tarih ve saat</div>
                </div>

                <!-- Recurring Transaction -->
                <div class="form-check">
                    <input asp-for="IsRecurring" class="form-check-input" type="checkbox" 
                           onchange="toggleRecurringSection()" />
                    <label asp-for="IsRecurring" class="form-check-label">
                        <strong>Otomatik Tekrar Eden İşlem</strong>
                        <div class="form-help">Bu işlem düzenli olarak tekrarlanacak</div>
                    </label>
                </div>

                <div class="recurring-section" id="recurringSection">
                    <div class="mb-3">
                        <label asp-for="RecurrenceType" class="form-label">
                            <i class="bi bi-arrow-repeat form-icon"></i>Tekrar Sıklığı
                        </label>
                        <select asp-for="RecurrenceType" class="form-select">
                            <option value="">Sıklık seçin...</option>
                            <option value="0">Aylık</option>
                            <option value="1">Haftalık</option>
                            <option value="2">Yıllık</option>
                        </select>
                        <div class="form-help">Bu işlem ne sıklıkla otomatik olarak tekrarlanacak?</div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-6 mb-2">
                        <a asp-action="Index" class="btn-secondary-action w-100">
                            <i class="bi bi-arrow-left me-2"></i>İptal Et
                        </a>
                    </div>
                    <div class="col-md-6">
                        <button type="submit" class="btn-primary-action w-100">
                            <i class="bi bi-floppy me-2"></i>Değişiklikleri Kaydet
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/js/transaction.js"></script>
}