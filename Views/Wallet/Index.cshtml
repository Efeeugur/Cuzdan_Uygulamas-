@model IEnumerable<CÃ¼zdan_UygulamasÄ±.BusinessLogic.DTOs.AccountDto>
@{
    ViewData["Title"] = "HesaplarÄ±m";
    var totalBalance = ViewBag.TotalBalance as decimal? ?? 0;
    var transactionSummary = ViewBag.TransactionSummary as CÃ¼zdan_UygulamasÄ±.BusinessLogic.DTOs.TransactionSummaryDto;
}


<div class="container-fluid px-4">
    <!-- Header -->
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="mb-0">ðŸ’³ HesaplarÄ±m</h2>
                <p class="text-muted mb-0">TÃ¼m hesaplarÄ±nÄ±zÄ± tek yerden yÃ¶netin</p>
            </div>
            <div class="col-auto">
                <a asp-action="CreateAccount" class="btn-primary-action">
                    <i class="bi bi-plus me-2"></i>Yeni Hesap
                </a>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    @if (transactionSummary != null)
    {
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="balance-card">
                    <h5 class="mb-1">Toplam Bakiye</h5>
                    <h3 class="mb-0">â‚º@totalBalance.ToString("N2")</h3>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-success">
                            <i class="bi bi-arrow-up fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Toplam Gelir</h6>
                        <h5 class="text-success">â‚º@transactionSummary.TotalIncome.ToString("N2")</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-danger">
                            <i class="bi bi-arrow-down fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Toplam Gider</h6>
                        <h5 class="text-danger">â‚º@transactionSummary.TotalExpense.ToString("N2")</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-info">
                            <i class="bi bi-calculator fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Net Tutar</h6>
                        <h5 class="@(transactionSummary.NetAmount >= 0 ? "text-success" : "text-danger")">
                            â‚º@transactionSummary.NetAmount.ToString("N2")
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    }

    <div>
        <h5>Hesaplar</h5>
    </div>

    <!-- Accounts List (YENÄ° GÃ–RÃœNÃœM) -->
    <div class="row"></div>
        <div class="col-12">
            @if (Model.Any())
            {
                <div class="item-list">
                    @foreach (var account in Model)
                    {
                        var initial = string.IsNullOrWhiteSpace(account.Name) ? "?" : account.Name.Trim()[0].ToString().ToUpper();
                        var amountClass = account.Balance >= 0 ? "positive" : "negative";

                        <div class="item-card">
                            <div class="item-inner">
                                <!-- Avatar / Ä°lk harf -->
                                <div class="item-avatar item-avatar--account" aria-hidden="true">@initial</div>

                                <!-- BaÅŸlÄ±k & aÃ§Ä±klama & rozetler -->
                                <div class="item-content">
                                    <p class="title mb-1">@account.Name</p>
                                    @if (!string.IsNullOrWhiteSpace(account.Description))
                                    {
                                        <p class="meta">@account.Description</p>
                                    }
                                    <div class="item-badges">
                                        <span class="item-chip">
                                            <i class="bi bi-receipt me-1"></i>@account.Transactions.Count() iÅŸlem
                                        </span>
                                    </div>
                                </div>

                                <!-- Bakiye -->
                                <div class="item-amount">
                                    <p class="value @amountClass">â‚º@account.Balance.ToString("N2")</p>
                                </div>

                                <!-- Aksiyonlar -->
                                <div class="item-actions">
                                    <a asp-action="AccountDetails" asp-route-id="@account.Id" class="btn-view-action btn-sm" title="Detay">
                                        <i class="bi bi-eye me-1"></i> Detay
                                    </a>
                                    <a asp-controller="Transaction" asp-action="Create" asp-route-accountId="@account.Id" class="btn-primary-action btn-sm" title="Yeni Ä°ÅŸlem">
                                        <i class="bi bi-plus me-1"></i> Ä°ÅŸlem
                                    </a>

                                    <div class="btn-group">
                                        <button class="btn-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" title="DiÄŸer">
                                            <i class="bi bi-gear"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li>
                                                <a class="dropdown-item" asp-action="EditAccount" asp-route-id="@account.Id">
                                                    <i class="bi bi-pencil me-2"></i>DÃ¼zenle
                                                </a>
                                            </li>
                                            <li><hr class="dropdown-divider" /></li>
                                            <li>
                                                <a class="dropdown-item text-danger" href="#" onclick="deleteAccount(@account.Id)">
                                                    <i class="bi bi-trash me-2"></i>Sil
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div> <!-- /.item-inner -->
                        </div> <!-- /.item-card -->
                    }
                </div> <!-- /.item-list -->
            }
            else
            {
                <div class="card border-0 shadow-sm">
                    <div class="card-body empty-state">
                        <i class="bi bi-wallet fa-4x mb-3"></i>
                        <h4>HenÃ¼z hesap eklenmemiÅŸ</h4>
                        <p>Ä°lk hesabÄ±nÄ±zÄ± oluÅŸturarak finansal takibi baÅŸlatÄ±n.</p>
                        <a asp-action="CreateAccount" class="btn-primary-action">
                            <i class="bi bi-plus me-2"></i>Ä°lk HesabÄ±mÄ± OluÅŸtur
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

        // Success/Error messages
        @if (TempData["Success"] != null)
        {
            <text>
            Swal.fire({
                icon: 'success',
                title: 'BaÅŸarÄ±lÄ±!',
                text: '@Html.Raw(TempData["Success"])',
                timer: 3000,
                showConfirmButton: false
            });
            </text>
        }

        @if (TempData["Error"] != null)
        {
            <text>
            Swal.fire({
                icon: 'error',
                title: 'Hata!',
                text: '@Html.Raw(TempData["Error"])'
            });
            </text>
        }
    </script>
}
