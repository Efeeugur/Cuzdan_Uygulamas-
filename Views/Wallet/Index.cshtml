@model IEnumerable<CÃ¼zdan_UygulamasÄ±.BusinessLogic.DTOs.AccountDto>
@{
    ViewData["Title"] = "HesaplarÄ±m";
    var totalBalance = ViewBag.TotalBalance as decimal? ?? 0;
    var transactionSummary = ViewBag.TransactionSummary as CÃ¼zdan_UygulamasÄ±.BusinessLogic.DTOs.TransactionSummaryDto;
}

<style>
    :root {
        --bg: #f5f5f7;
        --card: #ffffff;
        --text: #1d1d1f;
        --muted: #6e6e73;
        --blue: #007aff;
        --green: #28a745;
        --red: #dc3545;
        --border: rgba(0, 0, 0, 0.08);
        --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        --radius: 16px;
    }

    body { background: var(--bg); }

    /* ---- Header / Summary ---- */
    .wallet-header {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 24px;
        margin-bottom: 24px;
    }
    .balance-card {
        text-align: center;
        padding: 20px;
        border-radius: var(--radius);
        background: linear-gradient(135deg, var(--blue), #5AC8FA);
        color: white;
        margin-bottom: 20px;
    }

    /* ---- Eski account-card (gerekmeyebilir, ama kalsÄ±n) ---- */
    .account-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin-bottom: 16px;
    }
    .account-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    /* ---- Apple-esque buton ---- */
    .btn-apple {
        background: #000;
        color: white;
        border: none;
        border-radius: 12px;
        padding: 10px 20px;
        font-weight: 600;
        transition: all 0.2s ease;
    }
    .btn-apple:hover {
        background: #333;
        color: white;
        transform: translateY(-1px);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--muted);
    }

    /* ============================
       Apple-esque Account List (Yeni)
       ============================ */
    .account-list{
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    .account-item{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .account-item:hover{
      transform: translateY(-2px);
      box-shadow: 0 16px 50px rgba(0,0,0,.12);
      border-color: color-mix(in srgb, var(--blue) 20%, var(--border));
    }
    .account-inner{
      display: grid;
      grid-template-columns: auto 1fr auto auto;
      gap: 14px;
      align-items: center;
      padding: 16px 18px;
    }
    .account-avatar{
      width: 44px; height: 44px;
      border-radius: 12px;
      background: linear-gradient(135deg, #111, #333);
      color: #fff; display:flex; align-items:center; justify-content:center;
      font-weight: 700; letter-spacing: .02em;
    }
    .account-meta .title{
      font-weight: 700; letter-spacing: -.01em; margin: 0;
    }
    .account-meta .desc{
      margin: 2px 0 8px; color: var(--muted); font-size: .92rem;
    }
    .account-badges{
      display:flex; gap: 8px; flex-wrap: wrap;
    }
    .badge-chip{
      background: #f1f2f5;
      color: #1d1d1f;
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 4px 10px;
      font-size: .85rem;
    }
    .account-amount{
      text-align: right;
      min-width: 140px;
    }
    .account-amount .num{
      margin: 0;
      font-weight: 800;
      letter-spacing: -.02em;
    }
    .account-amount .pos{ color: var(--green); }
    .account-amount .neg{ color: var(--red); }
    .account-actions{
      display:flex; gap: 8px; align-items:center;
    }
    .btn-icon{
      height: 40px; padding: 0 12px;
      border-radius: 12px; border: 1px solid var(--border);
      background: #fff; color: var(--text); font-weight: 600;
      transition: background .2s ease, transform .04s ease, border-color .2s ease;
    }
    .btn-icon:hover{ background: color-mix(in srgb, var(--text) 6%, transparent); }
    .btn-icon:active{ transform: translateY(1px); }
    .btn-apple-sm{
      background: #000; color: #fff; border: none;
      height: 40px; padding: 0 14px; border-radius: 12px; font-weight: 700;
      transition: filter .2s ease, transform .04s ease;
    }
    .btn-apple-sm:hover{ filter: brightness(1.05); }
    .btn-apple-sm:active{ transform: translateY(1px); }
</style>

<div class="container-fluid px-4">
    <!-- Header -->
    <div class="wallet-header">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="mb-0">ðŸ’³ HesaplarÄ±m</h2>
                <p class="text-muted mb-0">TÃ¼m hesaplarÄ±nÄ±zÄ± tek yerden yÃ¶netin</p>
            </div>
            <div class="col-auto">
                <a asp-action="CreateAccount" class="btn btn-apple">
                    <i class="fas fa-plus me-2"></i>Yeni Hesap
                </a>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    @if (transactionSummary != null)
    {
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="balance-card">
                    <h5 class="mb-1">Toplam Bakiye</h5>
                    <h3 class="mb-0">â‚º@totalBalance.ToString("N2")</h3>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-success">
                            <i class="fas fa-arrow-up fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Toplam Gelir</h6>
                        <h5 class="text-success">â‚º@transactionSummary.TotalIncome.ToString("N2")</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-danger">
                            <i class="fas fa-arrow-down fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Toplam Gider</h6>
                        <h5 class="text-danger">â‚º@transactionSummary.TotalExpense.ToString("N2")</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-info">
                            <i class="fas fa-calculator fa-2x mb-2"></i>
                        </div>
                        <h6 class="text-muted">Net Tutar</h6>
                        <h5 class="@(transactionSummary.NetAmount >= 0 ? "text-success" : "text-danger")">
                            â‚º@transactionSummary.NetAmount.ToString("N2")
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    }

    <div>
        <h5>Hesaplar</h5>
    </div>

    <!-- Accounts List (YENÄ° GÃ–RÃœNÃœM) -->
    <div class="row">
        <div class="col-12">
            @if (Model.Any())
            {
                <div class="account-list">
                    @foreach (var account in Model)
                    {
                        var initial = string.IsNullOrWhiteSpace(account.Name) ? "?" : account.Name.Trim()[0].ToString().ToUpper();
                        var amountClass = account.Balance >= 0 ? "pos" : "neg";

                        <div class="account-item">
                            <div class="account-inner">
                                <!-- Avatar / Ä°lk harf -->
                                <div class="account-avatar" aria-hidden="true">@initial</div>

                                <!-- BaÅŸlÄ±k & aÃ§Ä±klama & rozetler -->
                                <div class="account-meta">
                                    <p class="title mb-1">@account.Name</p>
                                    @if (!string.IsNullOrWhiteSpace(account.Description))
                                    {
                                        <p class="desc">@account.Description</p>
                                    }
                                    <div class="account-badges">
                                        <span class="badge-chip">
                                            <i class="fas fa-receipt me-1"></i>@account.Transactions.Count() iÅŸlem
                                        </span>
                                    </div>
                                </div>

                                <!-- Bakiye -->
                                <div class="account-amount">
                                    <p class="num @amountClass">â‚º@account.Balance.ToString("N2")</p>
                                </div>

                                <!-- Aksiyonlar -->
                                <div class="account-actions">
                                    <a asp-action="AccountDetails" asp-route-id="@account.Id" class="btn-icon" title="Detay">
                                        <i class="fas fa-eye me-1"></i> Detay
                                    </a>
                                    <a asp-controller="Transaction" asp-action="Create" asp-route-accountId="@account.Id" class="btn-apple-sm" title="Yeni Ä°ÅŸlem">
                                        <i class="fas fa-plus me-1"></i> Ä°ÅŸlem
                                    </a>

                                    <div class="btn-group">
                                        <button class="btn-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" title="DiÄŸer">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li>
                                                <a class="dropdown-item" asp-action="EditAccount" asp-route-id="@account.Id">
                                                    <i class="fas fa-edit me-2"></i>DÃ¼zenle
                                                </a>
                                            </li>
                                            <li><hr class="dropdown-divider" /></li>
                                            <li>
                                                <a class="dropdown-item text-danger" href="#" onclick="deleteAccount(@account.Id)">
                                                    <i class="fas fa-trash me-2"></i>Sil
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div> <!-- /.account-inner -->
                        </div> <!-- /.account-item -->
                    }
                </div> <!-- /.account-list -->
            }
            else
            {
                <div class="card border-0 shadow-sm">
                    <div class="card-body empty-state">
                        <i class="fas fa-wallet fa-4x mb-3"></i>
                        <h4>HenÃ¼z hesap eklenmemiÅŸ</h4>
                        <p>Ä°lk hesabÄ±nÄ±zÄ± oluÅŸturarak finansal takibi baÅŸlatÄ±n.</p>
                        <a asp-action="CreateAccount" class="btn btn-apple">
                            <i class="fas fa-plus me-2"></i>Ä°lk HesabÄ±mÄ± OluÅŸtur
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function deleteAccount(id) {
            Swal.fire({
                title: 'Hesap Silinecek',
                text: 'Bu iÅŸlem geri alÄ±namaz!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Evet, Sil',
                cancelButtonText: 'Ä°ptal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Create form and submit
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/Wallet/DeleteAccount/' + id;

                    // Add anti-forgery token
                    const tokenSource = document.querySelector('input[name="__RequestVerificationToken"]');
                    if (tokenSource) {
                        const token = document.createElement('input');
                        token.type = 'hidden';
                        token.name = '__RequestVerificationToken';
                        token.value = tokenSource.value;
                        form.appendChild(token);
                    }

                    document.body.appendChild(form);
                    form.submit();
                }
            });
        }

        // Success/Error messages
        @if (TempData["Success"] != null)
        {
            <text>
            Swal.fire({
                icon: 'success',
                title: 'BaÅŸarÄ±lÄ±!',
                text: '@Html.Raw(TempData["Success"])',
                timer: 3000,
                showConfirmButton: false
            });
            </text>
        }

        @if (TempData["Error"] != null)
        {
            <text>
            Swal.fire({
                icon: 'error',
                title: 'Hata!',
                text: '@Html.Raw(TempData["Error"])'
            });
            </text>
        }
    </script>
}
